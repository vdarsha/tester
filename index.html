<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Google Login Redirect Test</title>
    <!-- Load Firebase libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script>
      // Replace with your Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDvQvYVbzsfKk_-TTlIruZt7Tf28b_XG_4",
      authDomain: "deskersizer.firebaseapp.com",
      projectId: "deskersizer",
      storageBucket: "deskersizer.firebasestorage.app",
      messagingSenderId: "848878159272",
      appId: "1:848878159272:web:8626b5d20738370924c99d"
      };

      firebase.initializeApp(firebaseConfig);
      const provider = new firebase.auth.GoogleAuthProvider();

      // Trigger sign in with redirect
      function signInWithGoogle() {
        firebase.auth().signInWithRedirect(provider);
      }

      window.onload = function() {
        firebase.auth().getRedirectResult()
          .then((result) => {
            if (result.user) {
              // User came back from sign in, get token:
              result.user.getIdToken().then((token) => {
                console.log('Firebase ID Token:', token);
                document.body.innerHTML = `<h1>Firebase ID Token:</h1><pre>${token}</pre>`;
                // Clear the redirect flag after a successful login.
                localStorage.removeItem('redirectAttempted');
              });
            } else if (firebase.auth().currentUser) {
              // In case the auth state is already set (e.g., due to a previously saved session)
              firebase.auth().currentUser.getIdToken().then((token) => {
                console.log('Token from currentUser:', token);
                document.body.innerHTML = `<h1>Firebase ID Token:</h1><pre>${token}</pre>`;
              });
            } else {
              // No user is signed in. Only trigger a redirect if we haven't done it already.
              // if (!localStorage.getItem('redirectAttempted')) {
              //   localStorage.setItem('redirectAttempted', 'true');
              //   signInWithGoogle();
              // } else {
                // If already attempted, show an option for the user to click manually
                document.body.innerHTML = `
                  <h1>Please sign in with Google</h1>
                  <button onclick="signInWithGoogle()">Sign in with Google</button>
                `;
              // }
            }
          })
          .catch((error) => {
            console.error("Error during sign-in redirect:", error);
            document.body.innerHTML = `<h1>Error occurred</h1><p>${error.message}</p>`;
          });
      };
    </script>
  </head>
  <body>
    <h1>Signing in with Google...</h1>
    <p>Please wait.</p>
  </body>
</html>
